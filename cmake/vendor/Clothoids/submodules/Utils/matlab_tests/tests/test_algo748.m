%=========================================================================%
%                                                                         %
%  Autors: Enrico Bertolazzi                                              %
%          Department of Industrial Engineering                           %
%          University of Trento                                           %
%          enrico.bertolazzi@unitn.it                                     %
%                                                                         %
%=========================================================================%

close all;

addpath('../lib');

solver = Algo748();

fun1  = @(x)     -2*sum( (2*(1:20)-5).^2./(x-(1:20).^2).^3 );
fun2  = @(x,a,b) a.*x.*exp(b.*x);
fun3  = @(x,n,a) x.^n-a;
fun4  = @(x,n)   2*x.*exp(-n)-2*exp(-n.*x)+1;
fun5  = @(x,n)   (1+(1-n).^2).*x-(1-n.*x).^2;
fun6  = @(x,n)   x.^2-(1-x).^n;
fun7  = @(x,n)   (1+(1-n).^4).*x-(1-n.*x).^4;
fun8  = @(x,n)   exp(-n.*x).*(x-1)+x.^n;
fun9  = @(x,n)   (n.*x-1)./((n-1).*x);
fun10 = @(x,n)   x.^(1./n)-n.^(1./n);

funs = {
  { pi/2, pi,       @(x) sin(x)-x./2 }, % [1] n.1

  { 1^2+1e-9,  2^2-1e-9,  fun1 }, % [1] n.2
  { 2^2+1e-9,  3^2-1e-9,  fun1 }, % [1] n.2
  { 3^2+1e-9,  4^2-1e-9,  fun1 }, % [1] n.2
  { 4^2+1e-9,  5^2-1e-9,  fun1 }, % [1] n.2
  { 5^2+1e-9,  6^2-1e-9,  fun1 }, % [1] n.2
  { 6^2+1e-9,  7^2-1e-9,  fun1 }, % [1] n.2
  { 7^2+1e-9,  8^2-1e-9,  fun1 }, % [1] n.2
  { 8^2+1e-9,  9^2-1e-9,  fun1 }, % [1] n.2
  { 9^2+1e-9,  10^2-1e-9, fun1 }, % [1] n.2
  { 10^2+1e-9, 11^2-1e-9, fun1 }, % [1] n.2

  { -9, 31, @(x) fun2(x,-40,-1)  }, % [1] n.3
  { -9, 31, @(x) fun2(x,-100,-2) }, % [1] n.3
  { -9, 31, @(x) fun2(x,-200,-3) }, % [1] n.3

  { 0, 5, @(x) fun3(x,4,0.2) }, % [1] n.4
  { 0, 5, @(x) fun3(x,6,0.2) }, % [1] n.4
  { 0, 5, @(x) fun3(x,8,0.2) }, % [1] n.4
  { 0, 5, @(x) fun3(x,10,0.2) }, % [1] n.4
  { 0, 5, @(x) fun3(x,12,0.2) }, % [1] n.4

  { 0, 5, @(x) fun3(x,8,1) }, % [1] n.4
  { 0, 5, @(x) fun3(x,10,1) }, % [1] n.4
  { 0, 5, @(x) fun3(x,12,1) }, % [1] n.4
  { 0, 5, @(x) fun3(x,14,1) }, % [1] n.4

  { 0, 1.5, @(x) sin(x)-1/2 }, % [1] n.5

  { 0, 1, @(x) fun4(x,1) }, % [1] n.6
  { 0, 1, @(x) fun4(x,2) }, % [1] n.6
  { 0, 1, @(x) fun4(x,3) }, % [1] n.6
  { 0, 1, @(x) fun4(x,4) }, % [1] n.6
  { 0, 1, @(x) fun4(x,5) }, % [1] n.6

  { 0, 1, @(x) fun4(x,20)  }, % [1] n.6
  { 0, 1, @(x) fun4(x,40)  }, % [1] n.6
  { 0, 1, @(x) fun4(x,60)  }, % [1] n.6
  { 0, 1, @(x) fun4(x,80)  }, % [1] n.6
  { 0, 1, @(x) fun4(x,100) }, % [1] n.6

  { 0, 1, @(x) fun5(x,5)  }, % [1] n.7
  { 0, 1, @(x) fun5(x,10) }, % [1] n.7
  { 0, 1, @(x) fun5(x,20) }, % [1] n.7

  { 0, 1, @(x) fun6(x,2)  }, % [1] n.8
  { 0, 1, @(x) fun6(x,5)  }, % [1] n.8
  { 0, 1, @(x) fun6(x,10) }, % [1] n.8
  { 0, 1, @(x) fun6(x,15) }, % [1] n.8
  { 0, 1, @(x) fun6(x,20) }, % [1] n.8

  { 0, 1, @(x) fun7(x,1)  }, % [1] n.9
  { 0, 1, @(x) fun7(x,2)  }, % [1] n.9
  { 0, 1, @(x) fun7(x,3)  }, % [1] n.9
  { 0, 1, @(x) fun7(x,5)  }, % [1] n.9
  { 0, 1, @(x) fun7(x,8)  }, % [1] n.9
  { 0, 1, @(x) fun7(x,15) }, % [1] n.9
  { 0, 1, @(x) fun7(x,20) }, % [1] n.9

  { 0, 1, @(x) fun8(x,1)  }, % [1] n.10
  { 0, 1, @(x) fun8(x,5)  }, % [1] n.10
  { 0, 1, @(x) fun8(x,10) }, % [1] n.10
  { 0, 1, @(x) fun8(x,15) }, % [1] n.10
  { 0, 1, @(x) fun8(x,20) }, % [1] n.10

  { 0.01, 1, @(x) fun9(x,2)  }, % [1] n.11
  { 0.01, 1, @(x) fun9(x,5)  }, % [1] n.11
  { 0.01, 1, @(x) fun9(x,15) }, % [1] n.11
  { 0.01, 1, @(x) fun9(x,20) }, % [1] n.11

  { 1, 100, @(x) fun10(x,2) }, % [1] n.12
  { 1, 100, @(x) fun10(x,3) }, % [1] n.12
  { 1, 100, @(x) fun10(x,4) }, % [1] n.12
  { 1, 100, @(x) fun10(x,5) }, % [1] n.12
  { 1, 100, @(x) fun10(x,6) }, % [1] n.12
  { 1, 100, @(x) fun10(x,7) }, % [1] n.12
  { 1, 100, @(x) fun10(x,8) }, % [1] n.12
  { 1, 100, @(x) fun10(x,9) }, % [1] n.12
  { 1, 100, @(x) fun10(x,11) }, % [1] n.12
  { 1, 100, @(x) fun10(x,13) }, % [1] n.12
  { 1, 100, @(x) fun10(x,15) }, % [1] n.12
  { 1, 100, @(x) fun10(x,17) }, % [1] n.12
  { 1, 100, @(x) fun10(x,19) }, % [1] n.12
  { 1, 100, @(x) fun10(x,21) }, % [1] n.12
  { 1, 100, @(x) fun10(x,23) }, % [1] n.12
  { 1, 100, @(x) fun10(x,25) }, % [1] n.12
  { 1, 100, @(x) fun10(x,27) }, % [1] n.12
  { 1, 100, @(x) fun10(x,29) }, % [1] n.12
  { 1, 100, @(x) fun10(x,31) }, % [1] n.12
  { 1, 100, @(x) fun10(x,33) }, % [1] n.12

  { -1, 4, @(x) fun11(x) }, % [1] n.13

  { -1e4, pi/2, @(x) fun12(x,1) }, % [1] n.13
  { -1e4, pi/2, @(x) fun12(x,2) }, % [1] n.13
  { -1e4, pi/2, @(x) fun12(x,3) }, % [1] n.13
  { -1e4, pi/2, @(x) fun12(x,4) }, % [1] n.13
  { -1e4, pi/2, @(x) fun12(x,5) }, % [1] n.13
  { -1e4, pi/2, @(x) fun12(x,6) }, % [1] n.13
  { -1e4, pi/2, @(x) fun12(x,7) }, % [1] n.13
  { -1e4, pi/2, @(x) fun12(x,8) }, % [1] n.13
  { -1e4, pi/2, @(x) fun12(x,0) }, % [1] n.13
  { -1e4, pi/2, @(x) fun12(x,10) }, % [1] n.13
  { -1e4, pi/2, @(x) fun12(x,20) }, % [1] n.13
  { -1e4, pi/2, @(x) fun12(x,30) }, % [1] n.13
  { -1e4, pi/2, @(x) fun12(x,40) }, % [1] n.13

  { -1e4, 1e-4, @(x) fun13(x,20) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,21) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,22) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,23) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,24) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,25) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,26) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,27) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,28) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,29) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,30) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,31) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,32) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,33) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,34) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,35) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,36) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,37) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,38) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,39) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,40) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,100) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,200) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,300) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,400) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,500) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,600) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,700) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,800) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,900) }, % [1] n.14
  { -1e4, 1e-4, @(x) fun13(x,1000) }, % [1] n.14

  { 0.5,  5,    @(x) log(x) },
  { 0.5,  8,    @(x) (10-x).*exp(-10*x)-x.^10+1 },
  { 1,    4,    @(x) exp(sin(x))-x-1 },
  { 0.5,  1,    @(x) 11*x.^11-1 },
  { 0.1,  pi/3, @(x) 2*sin(x)-1 },
  { 0,    1,    @(x) x.^2+sin(x./10)-0.25 },
  { 0,    1.5,  @(x) (x-1).*exp(x) },
  { 0,    1.7,  @(x) cos(x)-x },
  { 1.5,  3,    @(x) (x-1).^3-1 },
  { 2.6,  3.5,  @(x) exp(x.^2+7*x-30)-1 },
  { 1,    8,    @(x) atan(x)-1 },
  { 0.2,  3,    @(x) exp(x)-2*x-1 },
  { 0,    0.5,  @(x) exp(-x)-x-sin(x) },
  { 0.1,  1.5,  @(x) x.^3-1 },
  { -1,   2,    @(x) x.^2-sin(x).^2-1 },
  { -0.5, 1/3,  @(x) x.^3 },
  { -0.5, 1/3,  @(x) x.^5 },
};

for k=1:length(funs)
  a   = funs{k}{1};
  b   = funs{k}{2};
  fun = funs{k}{3};

  [sol,iter] = solver.eval( a, b, fun );

  if false
    x = a:(b-a)/1000:b;
    y = fun(x);

    hold off;
    plot(x,y,'LineWidth',2);
    hold on;
    plot(sol,fun(sol),'ob','MarkerSize',10,'MarkerFaceColor','red');
  end

  fprintf( ...
    '#%-3d iter = %-3d #nfun = %-3d x = %-12.6g f(x) = %-.3g\n', ...
    k, solver.num_iter_done(), solver.num_fun_eval(), sol, fun(sol) ...
  );
end

function res = fun11( x )
  res      = zeros(size(x));
  idx      = find( x ~= 0 );
  res(idx) = x(idx).*exp(-1./x(idx).^2);
end

function res = fun12( x, n )
  res = -ones(size(x))*n/20;
  idx = find( x >= 0 );
  if length(idx) > 0
    res(idx) = res(idx).*(1-x(idx)./1.5-sin(x(idx)));
  end
end

function res = fun13( x, n )
  res = zeros(size(x));
  idx = find( x > 2e-3./(1+n));
  if length(idx) > 0
    res(idx) = exp(1)-1.859;
  end
  idx = find( x < 0 );
  if length(idx) > 0
    res(idx) = -0.859;
  end
  idx = find( x >= 0 & x <= 2e-3/(1+n));
  if length(idx) > 0
    res(idx) = exp( (n+1).*0.5e3.*x(idx))-1.859;
  end
end
